<div id="rfq-evaluation" fxFlex fusePerfectScrollbar>
  <div fxLayout="column" fxLayoutAlign="start center" class="py-8 pl-24">
      <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="1rem" style="width: 100%;">
          <button mat-icon-button (click)="CancelClicked()">
              <img src="assets/images/rfq/backbutton.svg" style="width: 24px;">
          </button>
          <label class="title">Response by {{ResH.PartnerID}}</label>
          <div fxFlex></div>
            <div fxLayout="row" fxLayoutAlign="end center" fxFlex class="mr-16" *ngIf="EvalHeader.Status!='2'">
                <button mat-button style="background-color: transparent;" (click)="SaveEvalClicked(false)">
                    <img src="/assets/images/rfq/saveAsDraft.svg">
                    <span class="saveAsDraft">Save as Draft</span>
                </button>
            </div>
      </div>
      <div class="container mt-8 p-8">
          <mat-tab-group [selectedIndex]="selectedIndex" (selectedTabChange)="tabClick($event)" color="accent"
              backgroundColor="primary" class="tab-group">
              <mat-tab>
                  <ng-template mat-tab-label>
                      <span>General data</span>
                  </ng-template>
                  <mat-card class="card">
                      <form autocomplete="off" [formGroup]="RFxFormGroup">
                          <div fxLayout="column" fxLayoutGap="8px">
                            <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="24px">
                                <mat-form-field fxFlex="724px" class="rfx-form-field" appearance="outline">
                                    <mat-label>Title</mat-label>
                                    <input matInput type="text" formControlName="RfqTitle" fxFlex>
                                </mat-form-field>
                            </div>

                            <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="24px">
                                <mat-form-field fxFlex="350px" appearance="outline" class="rfx-form-field">
                                    <mat-label>RFx type</mat-label>
                                    <mat-select formControlName="RfqType" fxFlex disableOptionCentering
                                        panelClass="myPanelClass">
                                        <mat-option *ngFor="let type of RFxTypeMasters" [value]="type.RFQType">
                                            {{type.Text}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>

                                <mat-form-field fxFlex="350px" appearance="outline" class="rfx-form-field">
                                    <mat-label>Group</mat-label>
                                    <mat-select formControlName="RfqGroup" fxFlex disableOptionCentering
                                        panelClass="myPanelClass">
                                        <mat-option *ngFor="let group of RFxGroupMasters" [value]="group.RFQGroup">
                                            {{group.Text}}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                            <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="24px">
                                <mat-form-field fxFlex="350px" appearance="outline" class="rfx-form-field">
                                    <mat-label>Minimum no. of evaluators</mat-label>
                                    <input matInput formControlName="Evaluator"
                                        oninput="this.value = Math.abs(this.value)" fxFlex type="number">
                                </mat-form-field>
                                <mat-form-field fxFlex="350px" appearance="outline" class="rfx-form-field">
                                    <mat-label>Currency</mat-label>
                                    <mat-select formControlName="Currency" fxFlex disableOptionCentering
                                        panelClass="myPanelClass">
                                        <mat-option *ngFor="let currency of CurrencyList" [value]="currency">
                                            {{currency}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                            <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="24px">
                                <mat-form-field fxFlex="350px" appearance="outline" class="rfx-form-field">
                                    <mat-label>Plant</mat-label>
                                    <mat-select formControlName="Plant" fxFlex disableOptionCentering
                                        panelClass="myPanelClass">
                                        <mat-option *ngFor="let plant of Plants" [value]="plant">
                                            {{plant}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                            <div fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="24px">
                                <div fxLayout="column" fxLayoutGap="8px">
                                    <span class="datetime">Validity</span>
                                    <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="24px">
                                        <mat-form-field fxFlex="163px" appearance="outline" class="rfx-form-field">
                                            <input matInput [matDatepicker]="picker1"
                                                formControlName="ValidityStartDate" fxFlex placeholder="Sart Date">
                                            <img src="assets/images/rfq/date_picker.svg" width="16px"
                                                class="clickable" (click)="picker1.open()">
                                            <mat-datepicker #picker1></mat-datepicker>
                                        </mat-form-field>

                                        <mat-form-field appearance="outline" fxFlex="163px" class="rfx-form-field">
                                            <input matInput [ngxTimepicker]="picker9"
                                                formControlName="ValidityStartTime" fxFlex placeholder="Start Time">
                                            <img src="assets/images/rfq/time_picker.svg" width="16px">
                                            <ngx-material-timepicker #picker9></ngx-material-timepicker>
                                        </mat-form-field>
                                    </div>
                                    <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="24px">
                                        <mat-form-field appearance="outline" fxFlex="163px" class="rfx-form-field">
                                            <input matInput
                                                [matDatepicker]="picker2" formControlName="ValidityEndDate" fxFlex
                                                placeholder="End Date">
                                            <img src="assets/images/rfq/date_picker.svg" width="16px"
                                                class="clickable" (click)="picker2.open()">
                                            <mat-datepicker #picker2></mat-datepicker>
                                        </mat-form-field>

                                        <mat-form-field appearance="outline" fxFlex="163px" class="rfx-form-field">
                                            <input matInput [ngxTimepicker]="picker10"
                                                formControlName="ValidityEndTime" fxFlex placeholder="End Time">
                                            <img src="assets/images/rfq/time_picker.svg" width="16px">
                                            <ngx-material-timepicker #picker10></ngx-material-timepicker>
                                        </mat-form-field>
                                    </div>
                                </div>
                                <div fxLayout="column" fxLayoutGap="8px">
                                    <span class="datetime">Response</span>
                                    <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="24px">
                                        <mat-form-field appearance="outline" fxFlex="163px" class="rfx-form-field">
                                            <input matInput
                                                [matDatepicker]="picker3" formControlName="ResponseStartDate" fxFlex
                                                placeholder="Start Date">
                                            <img src="assets/images/rfq/date_picker.svg" width="16px"
                                                class="clickable" (click)="picker3.open()">
                                            <mat-datepicker #picker3></mat-datepicker>
                                        </mat-form-field>

                                        <mat-form-field appearance="outline" fxFlex="163px" class="rfx-form-field">
                                            <input matInput [ngxTimepicker]="picker6"
                                                formControlName="ResponseStartTime" fxFlex placeholder="Start Time">
                                            <img src="assets/images/rfq/time_picker.svg" width="16px">
                                            <ngx-material-timepicker #picker6></ngx-material-timepicker>
                                        </mat-form-field>
                                    </div>
                                    <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="24px">
                                        <mat-form-field appearance="outline" fxFlex="163px" class="rfx-form-field">
                                            <input matInput
                                                [matDatepicker]="picker4" formControlName="ResponseEndDate" fxFlex
                                                placeholder="End Date">
                                            <img src="assets/images/rfq/date_picker.svg" width="16px"
                                                class="clickable" (click)="picker4.open()">
                                            <mat-datepicker #picker4></mat-datepicker>
                                        </mat-form-field>

                                        <mat-form-field appearance="outline" fxFlex="163px" class="rfx-form-field">
                                            <input matInput [ngxTimepicker]="picker7"
                                                formControlName="ResponseEndTime" fxFlex placeholder="End Time">
                                            <img src="assets/images/rfq/time_picker.svg" width="16px">
                                            <ngx-material-timepicker #picker7></ngx-material-timepicker>
                                        </mat-form-field>
                                    </div>
                                </div>
                                <div fxLayout="column" fxLayoutGap="8px">
                                    <span class="datetime">Evaluation</span>
                                    <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="24px">
                                        <mat-form-field appearance="outline" fxFlex="163px" class="rfx-form-field">
                                            <input matInput
                                                [matDatepicker]="picker13" formControlName="EvaluationStartDate"
                                                fxFlex placeholder="Start Date">
                                            <img src="assets/images/rfq/date_picker.svg" width="16px"
                                                class="clickable" (click)="picker13.open()">
                                            <mat-datepicker #picker13></mat-datepicker>
                                        </mat-form-field>

                                        <mat-form-field appearance="outline" fxFlex="163px" class="rfx-form-field">
                                            <input matInput [ngxTimepicker]="picker12"
                                                formControlName="EvaluationStartTime" fxFlex
                                                placeholder="Start Time">
                                            <img src="assets/images/rfq/time_picker.svg" width="16px">
                                            <ngx-material-timepicker #picker12></ngx-material-timepicker>
                                        </mat-form-field>
                                    </div>
                                    <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="24px">
                                        <mat-form-field appearance="outline" fxFlex="163px" class="rfx-form-field">
                                            <input matInput
                                                [matDatepicker]="picker5" formControlName="EvaluationEndDate" fxFlex
                                                placeholder="End Date">
                                            <img src="assets/images/rfq/date_picker.svg" width="16px"
                                                class="clickable" (click)="picker5.open()">
                                            <mat-datepicker #picker5></mat-datepicker>
                                        </mat-form-field>

                                        <mat-form-field appearance="outline" fxFlex="163px" class="rfx-form-field">
                                            <input matInput [ngxTimepicker]="picker8"
                                                formControlName="EvaluationEndTime" fxFlex placeholder="End Time">
                                            <img src="assets/images/rfq/time_picker.svg" width="16px">
                                            <ngx-material-timepicker #picker8></ngx-material-timepicker>
                                        </mat-form-field>
                                    </div>
                                </div>
                            </div>                              
                          </div>
                      </form>
                  </mat-card>
              </mat-tab>
              <mat-tab>
                  <ng-template mat-tab-label>
                      <span>System Criteria</span>
                  </ng-template>
                  <mat-card class="card">
                      <div fxLayout="column">
                          <div fxLayout="row" fxLayoutAlign="space-between center" class="pb-24">
                              <label class="tab-title">System Criterias</label>
                          </div>
                              <table mat-table [dataSource]="RatingDetailsDataSource" matSort class="py-10">
                                  <ng-container matColumnDef="Criteria">
                                      <th mat-header-cell mat-sort-header *matHeaderCellDef> Criteria </th>
                                      <td mat-cell *matCellDef="let element;">{{element.Criteria}}</td>
                                  </ng-container>

                                  <ng-container matColumnDef="Weightage">
                                      <th mat-header-cell *matHeaderCellDef>Weightage</th>
                                      <td mat-cell *matCellDef="let element;">{{element.Weightage}}</td>
                                  </ng-container>

                                  <ng-container matColumnDef="Consider">
                                      <th mat-header-cell *matHeaderCellDef>Consider</th>
                                      <td mat-cell *matCellDef="let element;">{{GetConsider(element.Consider)}}</td>
                                  </ng-container>

                                  <tr mat-header-row *matHeaderRowDef="RatingDetailsDisplayedColumns"></tr>
                                  <tr mat-row *matRowDef="let row; columns: RatingDetailsDisplayedColumns;"></tr>
                              </table>
                      </div>
                  </mat-card>
              </mat-tab>
              <mat-tab>
                  <ng-template mat-tab-label>
                      <span>Evaluation Criteria</span>
                      <div *ngIf="!IsComplete()" class="square" [ngStyle]="{'background-color':selectedIndex==2?'#ffffff':'#18a421'}"></div>
                  </ng-template>
                  <mat-card class="card">
                      <div fxLayout="column">
                          <div fxLayout="row" fxLayoutAlign="space-between center" class="pb-24">
                              <label class="tab-title">Evaluation Criterias</label>
                          </div>
                          <table mat-table [dataSource]="EvaluationDetailsDataSource" matSort class="py-10">
                              <ng-container matColumnDef="Description">
                                  <th mat-header-cell mat-sort-header *matHeaderCellDef> Description </th>
                                  <td mat-cell *matCellDef="let element"> {{element.Text}} </td>
                              </ng-container>
                              <ng-container matColumnDef="Rating">
                                  <th mat-header-cell *matHeaderCellDef> Rating </th>
                                  <td mat-cell *matCellDef="let element;index as i;">
                                      <div style="width:10rem;">
                                          <star-rating [value]="EvalHcs[i]?.Rating" checkedcolor="gold" uncheckedcolor="#b9bdbb" size="20px" readonly="false"
                                          (rate)="onRate($event,i)"></star-rating>
                                      </div>
                                  </td>
                              </ng-container>
                              <tr mat-header-row *matHeaderRowDef="EvaluationDetailsDisplayedColumns"></tr>
                              <tr mat-row *matRowDef="let row; columns: EvaluationDetailsDisplayedColumns;"></tr>
                          </table>
                      </div>
                  </mat-card>
              </mat-tab>
              <mat-tab>
                  <ng-template mat-tab-label>
                      <span>Item</span>
                  </ng-template>
                  <mat-card class="card">
                      <div fxLayout="column">
                          <div fxLayout="row" fxLayoutAlign="space-between center" class="pb-24">
                              <label class="tab-title">Items</label>
                          </div>
                          <table mat-table [dataSource]="ItemDetailsDataSource" matSort class="py-10">
                              <ng-container matColumnDef="Material">
                                  <th mat-header-cell mat-sort-header *matHeaderCellDef> Material </th>
                                  <td mat-cell *matCellDef="let element"> {{element.Material}} </td>
                              </ng-container>

                              <ng-container matColumnDef="MaterialText">
                                  <th mat-header-cell mat-sort-header *matHeaderCellDef>Material text</th>
                                  <td mat-cell *matCellDef="let element"> {{element.MaterialText}} </td>
                              </ng-container>

                              <ng-container matColumnDef="TotalQty">
                                  <th mat-header-cell mat-sort-header *matHeaderCellDef> Total qty </th>
                                  <td mat-cell *matCellDef="let element" class="qty"> {{element.TotalQty}}
                                  </td>
                              </ng-container>

                              <ng-container matColumnDef="PerScheduleQty">
                                  <th mat-header-cell mat-sort-header *matHeaderCellDef> Per schedule qty </th>
                                  <td mat-cell *matCellDef="let element" class="qty"> {{element.PerScheduleQty}}
                                  </td>
                              </ng-container>

                              <ng-container matColumnDef="TotalSchedules">
                                  <th mat-header-cell mat-sort-header *matHeaderCellDef> No. of schedules </th>
                                  <td mat-cell *matCellDef="let element" class="qty"> {{element.TotalSchedules}}</td>
                              </ng-container>

                              <ng-container matColumnDef="UOM">
                                  <th mat-header-cell mat-sort-header *matHeaderCellDef> UOM </th>
                                  <td mat-cell *matCellDef="let element"> {{element.UOM}}</td>
                              </ng-container>

                              <ng-container matColumnDef="IncoTerm">
                                  <th mat-header-cell mat-sort-header *matHeaderCellDef> Incoterm </th>
                                  <td mat-cell *matCellDef="let element"> {{element.IncoTerm}}</td>
                              </ng-container>

                              <ng-container matColumnDef="Action">
                                  <th mat-header-cell *matHeaderCellDef style="text-align: center;"> Action
                                  </th>
                                  <td mat-cell *matCellDef="let element;index as i;" style="text-align: center;">
                                      <button mat-icon-button (click)="OpenEvaItemDialog(element)">
                                          <mat-icon style="color: #5f2cff;">launch</mat-icon>
                                      </button>
                                  </td>
                              </ng-container>

                              <tr mat-header-row *matHeaderRowDef="ItemsDetailsDisplayedColumns"></tr>
                              <tr mat-row *matRowDef="let row; columns: ItemsDetailsDisplayedColumns;"></tr>
                          </table>
                      </div>
                  </mat-card>
              </mat-tab>
              
              <mat-tab>
                  <ng-template mat-tab-label>
                      <span>Questions</span>
                  </ng-template>
                  <mat-card class="card">
                      <div fxLayout="column">
                          <div>
                              <div fxLayout="row" fxLayoutAlign="space-between center" class="pb-24">
                                  <label class="tab-title">Questions</label>
                              </div>
                              <table mat-table [dataSource]="ODDetailsDataSource" matSort class="py-10">
                                  <ng-container matColumnDef="Question">
                                      <th mat-header-cell mat-sort-header *matHeaderCellDef> Question </th>
                                      <td mat-cell *matCellDef="let element"> {{element.Qusetion}} </td>
                                  </ng-container>

                                  <ng-container matColumnDef="Answer">
                                      <th mat-header-cell mat-sort-header *matHeaderCellDef> Answer </th>
                                      <td mat-cell *matCellDef="let element"> {{element.Answer}}
                                      </td>
                                  </ng-container>
                                  <tr mat-header-row *matHeaderRowDef="ODDetailsDisplayedColumns"></tr>
                                  <tr mat-row *matRowDef="let row; columns: ODDetailsDisplayedColumns;"></tr>
                              </table>
                          </div>
                      </div>
                  </mat-card>
              </mat-tab>
              <mat-tab>
                <ng-template mat-tab-label>
                    <span>Documents</span>
                </ng-template>
                <mat-card class="card">
                    <div fxLayout="column">
                        <div>
                            <div fxLayout="row" fxLayoutAlign="space-between center" class="py-24">
                                <label class="tab-title">Documents</label>
                            </div>
                            <table mat-table [dataSource]="ODAttachDetailsDataSource" matSort class="py-10">
                                <ng-container matColumnDef="DocumentTitle">
                                    <th mat-header-cell mat-sort-header *matHeaderCellDef> Document title </th>
                                    <td mat-cell *matCellDef="let element"> {{element.DocumentTitle}} </td>
                                </ng-container>

                                <ng-container matColumnDef="DocumentName">
                                    <th mat-header-cell mat-sort-header *matHeaderCellDef> Document </th>
                                    <td mat-cell *matCellDef="let element"> {{element.DocumentName}} </td>
                                </ng-container>
                                <ng-container matColumnDef="Action">
                                    <th mat-header-cell *matHeaderCellDef style="text-align: right;"> View/Download</th>
                                    <td mat-cell *matCellDef="let element" style="text-align: right;">
                                        <button mat-icon-button (click)="DownloadRFxAttachment(RFxID,element.DocumentName)">
                                            <mat-icon style="color: #5f2cff;">save_alt</mat-icon>
                                        </button>
                                    </td>
                                </ng-container>
                                <tr mat-header-row *matHeaderRowDef="ODAttachDetailsDisplayedColumns"></tr>
                                <tr mat-row *matRowDef="let row; columns: ODAttachDetailsDisplayedColumns;"></tr>
                            </table>
                        </div>
                    </div>
                </mat-card>
            </mat-tab>
            <mat-tab>
                <ng-template mat-tab-label>
                    <span>Text</span>
                </ng-template>
                <mat-card class="card">
                    <div fxLayout="column">
                        <div fxLayout="column" class="my-24" fxLayoutGap="1rem">
                            <div fxLayout="row" fxLayoutAlign="space-between center">
                                <label class="tab-title">Remarks</label>
                            </div>
                            <mat-form-field appearance="outline">
                                <textarea matInput fxFlex
                                    [(ngModel)]="RFxRemark.Remark" [disabled]="true"></textarea>
                            </mat-form-field>
                            <div fxLayout="row" fxLayoutAlign="space-between center">
                                <label class="tab-title">Response remarks</label>
                            </div>
                            <mat-form-field appearance="outline">
                                <textarea matInput fxFlex
                                    [(ngModel)]="ResH.ResRemarks" [disabled]="true"></textarea>
                            </mat-form-field>
                            <div fxLayout="row" fxLayoutAlign="space-between center">
                                <label class="tab-title">Evaluation remarks</label>
                            </div>
                            <mat-form-field appearance="outline">
                                <textarea matInput fxFlex
                                    [(ngModel)]="EvalRemarks"></textarea>
                            </mat-form-field>
                        </div>
                    </div>
                </mat-card>
            </mat-tab>
          </mat-tab-group>
      </div>
      
  </div>
  <div class="footer px-24" fxLayout="row" fxLayoutAlign="space-between center">
    <div fxFlex></div>
      <div *ngIf="!IsComplete() || EvalHeader.Status=='2'" fxFlex="144px" fxLayout="row"  fxLayoutAlign="end center" fxLayoutGap="24px" class="px-8">
        <span fxLayoutAlign="start center" fxLayoutGap="8px" *ngIf="selectedIndex!=0" (click)="PreviousClicked(selectedIndex)" class="prevnxtbtn clickable">
            <img src="assets/images/rfq/nextprev.svg">
            <span>Previous</span>
        </span>
        <div fxFlex></div>
        <span fxLayoutAlign="start center" fxLayoutGap="8px" *ngIf="selectedIndex!=6" (click)="NextClicked(selectedIndex)" mat-button
            class="prevnxtbtn clickable">
            <span>Next</span>
            <img src="assets/images/rfq/nextprev.svg" style="transform: rotate(180deg);">
        </span>
      </div>
      <div *ngIf="IsComplete() && EvalHeader.Status!='2'" fxFlex="144px" fxLayout="row"  fxLayoutAlign="end center" fxLayoutGap="24px" class="px-8">
          <span fxLayoutAlign="center center" fxLayoutGap="8px"  class="prevnxtbtn clickable" (click)="SaveEvalClicked(true)">
            <span>Release</span>
            <img src="assets/images/rfq/releasetick.svg">
        </span>
      </div>
  </div>
  <mat-progress-spinner *ngIf="isProgressBarVisibile" class="progressBarPostion" color="accent" mode="indeterminate">
  </mat-progress-spinner>
  <div id="overlay" *ngIf="isProgressBarVisibile"></div>
</div>